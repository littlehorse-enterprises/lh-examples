<h2 mat-dialog-title>Your Shopping Cart</h2>

<mat-dialog-content>
  <div class="empty-cart" *ngIf="cartItems.length === 0">
    <mat-icon class="empty-icon">shopping_basket</mat-icon>
    <p>Your cart is empty</p>
    <button mat-raised-button color="primary" (click)="close()">Continue Shopping</button>
  </div>

  <div class="cart-items" *ngIf="cartItems.length > 0">
    <div class="cart-item" *ngFor="let item of cartItems">
      <div class="item-image">
        <img [src]="'/assets/images/products/' + item.product.productId + '.png'" [alt]="item.product.name">
      </div>
      
      <div class="item-details">
        <div class="item-header">
          <h3>{{ item.product.name }}</h3>
          <span class="item-category">{{ item.product.category }}</span>
        </div>
        
        <p class="item-description">{{ item.product.description }}</p>
        
        <div class="item-price">
          <span class="price">${{ item.product.unitPrice.toFixed(2) }}</span>
          <span class="item-total">${{ (item.product.unitPrice * item.quantity).toFixed(2) }}</span>
        </div>
        
        <div class="item-controls">
          <div class="quantity-controls">
            <button mat-icon-button color="primary" (click)="decreaseQuantity(item)" [disabled]="item.quantity <= 1">
              <mat-icon>remove</mat-icon>
            </button>
            <span class="quantity">{{ item.quantity }}</span>
            <button mat-icon-button color="primary" (click)="increaseQuantity(item)" 
                   [disabled]="item.quantity >= item.product.quantity">
              <mat-icon>add</mat-icon>
            </button>
          </div>
          
          <button mat-icon-button color="warn" (click)="removeItem(item)" matTooltip="Remove item">
            <mat-icon>delete</mat-icon>
          </button>
        </div>
        
        <mat-divider></mat-divider>
        
        <div class="discount-section">
          <div class="discount-input" *ngIf="!item.discountApplied">
            <mat-form-field appearance="outline">
              <mat-label>Discount code</mat-label>
              <input matInput [(ngModel)]="item.discountCode">
              <button *ngIf="item.discountCode" matSuffix mat-icon-button aria-label="Clear"
                     (click)="item.discountCode=''">
                <mat-icon>close</mat-icon>
              </button>
            </mat-form-field>
            <button mat-raised-button color="accent" [disabled]="!item.discountCode" (click)="applyDiscountCode(item)">
              Apply
            </button>
          </div>
          
          <div class="discount-applied" *ngIf="item.discountApplied">
            <div class="discount-info">
              <mat-icon color="accent">local_offer</mat-icon>
              <span>10% discount applied with code: {{ item.discountCode }}</span>
            </div>
            <button mat-icon-button color="warn" (click)="removeDiscount(item)" matTooltip="Remove discount">
              <mat-icon>close</mat-icon>
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>
  
  <div class="order-summary" *ngIf="cartItems.length > 0">
    <h3>Order Summary</h3>
    <div class="summary-row">
      <span>Subtotal:</span>
      <span>${{ subtotal.toFixed(2) }}</span>
    </div>
    <div class="summary-row discount" *ngIf="discount > 0">
      <span>Discount:</span>
      <span>-${{ discount.toFixed(2) }}</span>
    </div>
    <mat-divider></mat-divider>
    <div class="summary-row total">
      <span>Total:</span>
      <span>${{ total.toFixed(2) }}</span>
    </div>
  </div>
</mat-dialog-content>

<mat-dialog-actions align="end">
  <button mat-button (click)="close()">Cancel</button>
  <button mat-raised-button color="primary" [disabled]="cartItems.length === 0" (click)="checkout()">
    Proceed to Checkout
  </button>
</mat-dialog-actions>
